affine sobel_x_scop_0 {X,Y| X>=0 && Y>=0 }
	input
		float img {j0,j1| j1-1==0 && j0>=0 && -j0+X-1>=0 && Y>=0 } || {j0,j1| j1>=0 && -j1+Y-3>=0 && j0>=0 && -j0+X-1>=0 } ||
		{j0,j1| j1-2>=0 && -j1+Y-1>=0 && j0>=0 && -j0+X-1>=0 } ;
		float tmp1 {j0,j1| j1-Y+2==0 && j0>=0 && -j0+X-1>=0 && -Y+1>=0 && Y>=0 } || {j0,j1| j1>=0 && -j1+Y-1>=0 && -j0+1>=0
		&& j0-X>=0 && X>=0 } || {j0,j1| -j0-1>=0 && -j1+Y-1>=0 && j0-X+2>=0 && j1>=0 && X>=0 } ;
	local
		float S0 {i| i>=0 && -i+X-1>=0 && X>=0 && Y>=0 } ;
		float S1 {i,j| j-1>=0 && -j+Y-2>=0 && i>=0 && -i+X-1>=0 && X>=0 && Y>=0 } ;
		float S2 {i| i>=0 && -i+X-1>=0 && X>=0 && Y>=0 } ;
		float S3 {j| j>=0 && -j+Y-1>=0 && X>=0 && Y>=0 } ;
		float S4 {j,i| i-1>=0 && -i+X-2>=0 && j>=0 && -j+Y-1>=0 && X>=0 && Y>=0 } ;
		float S5 {j| j>=0 && -j+Y-1>=0 && X>=0 && Y>=0 } ;
	let
		S0[i] = - img[i,1];
		S1[i,j] = (img[i,j-1] - img[i,j+1]);
		S2[i] = case
			{i| Y-2==0 && i>=0 && X-i-1>=0 } : S0[i] ;
			{i| X-i-1>=0 && Y-3>=0 && i>=0 } : S1[i,Y-2] ;
			{i| -Y+1>=0 } : tmp1[i,Y-2] ;
		esac;
		S3[j] = ((2 * case
			{j| j==0 && X-1>=0 && Y-2>=0 } : S0[0] ;
			{j| Y-j-2>=0 && X-1>=0 && j-1>=0 } : S1[0,j] ;
			{j| -Y+j+1==0 && Y-1>=0 && X-1>=0 } : S2[0] ;
			{j| X==0 } : tmp1[0,j] ;
		esac) + case
			{j| j==0 && X-2>=0 && Y-2>=0 } : S0[1] ;
			{j| j-1>=0 && Y-j-2>=0 && X-2>=0 } : S1[1,j] ;
			{j| -Y+j+1==0 && X-2>=0 && Y-1>=0 } : S2[1] ;
			{j| -X+1>=0 } : tmp1[1,j] ;
		esac);
		S4[j,i] = ((case
			{j,i| j==0 && Y-2>=0 && i-1>=0 && X-i-2>=0 } : S0[i-1] ;
			{j,i| j-1>=0 && Y-j-2>=0 && i-1>=0 && X-i-2>=0 } : S1[i-1,j] ;
			{j,i| -Y+j+1==0 && Y-1>=0 && i-1>=0 && X-i-2>=0 } : S2[i-1] ;
		esac + (2 * case
			{j,i| j==0 && i-1>=0 && X-i-2>=0 && Y-2>=0 } : S0[i] ;
			{j,i| i-1>=0 && X-i-2>=0 && j-1>=0 && Y-j-2>=0 } : S1[i,j] ;
			{j,i| -Y+j+1==0 && i-1>=0 && Y-1>=0 && X-i-2>=0 } : S2[i] ;
		esac)) + case
			{j,i| j==0 && i-1>=0 && X-i-2>=0 && Y-2>=0 } : S0[i+1] ;
			{j,i| i-1>=0 && X-i-2>=0 && j-1>=0 && Y-j-2>=0 } : S1[i+1,j] ;
			{j,i| -Y+j+1==0 && i-1>=0 && Y-1>=0 && X-i-2>=0 } : S2[i+1] ;
		esac);
		S5[j] = (case
			{j| j==0 && X-2>=0 && Y-2>=0 } : S0[X-2] ;
			{j| Y-j-2>=0 && X-2>=0 && j-1>=0 } : S1[X-2,j] ;
			{j| -Y+j+1==0 && Y-1>=0 && X-2>=0 } : S2[X-2] ;
			{j| -X+1>=0 } : tmp1[X-2,j] ;
		esac + (2 * case
			{j| j==0 && X-1>=0 && Y-2>=0 } : S0[X-1] ;
			{j| j-1>=0 && Y-j-2>=0 && X-1>=0 } : S1[X-1,j] ;
			{j| -Y+j+1==0 && X-1>=0 && Y-1>=0 } : S2[X-1] ;
			{j| X==0 } : tmp1[X-1,j] ;
		esac));
.